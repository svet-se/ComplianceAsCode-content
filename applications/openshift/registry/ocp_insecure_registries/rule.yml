prodtype: ocp4

title: "Check if any insecure registries are configured"

description: |-
    The configuration <tt>registrySources.insecureRegistries</tt> determines the
    insecure registries that the OpenShift container runtime can access for builds
    and pods. This configuration setting is for accessing the configured registries
    without TLS validation which could lead to security breaches and should be
    avoided.
    You can remove any insecureRegistries configured by applying the following
    manifest using <pre>oc patch</pre>, e.g. if you save the following snippet to
    <pre>/tmp/remove-insecure-registries-patch.yaml</pre>
    <pre>
    spec:
      registrySources:
        insecureRegistries:
    </pre> you would call
    <pre>oc patch images.config.openshift.io cluster --patch="$(cat /tmp/remove-insecure-registries-patch.yaml)" --type=merge</pre>

rationale: |-
    Insecure registries should not be configured, which would restrict the possibilities of
    OpenShift container runtime accessing registries which cannot be validated.

severity: medium

references:
    nist: CM-5(3),CM-7(2),CM-7(4),CM-7(5),CM-11
    srg: SRG-APP-000131-CTR-000280,SRG-APP-000131-CTR-000285,SRG-APP-000384-CTR-000915

warnings:
    - general: |-
        {{{ openshift_cluster_setting("/apis/config.openshift.io/v1/images/cluster") | indent(8) }}}

template:
    name: yamlfile_value
    vars:
        ocp_data: 'true'
        filepath: /apis/config.openshift.io/v1/images/cluster
        yamlpath: ".spec.registrySources.insecureRegistries[:]"
        entity_check: "at least one"
        values:
            - value: ".*"
              operation: "pattern match"
