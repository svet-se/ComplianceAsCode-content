documentation_complete: true

prodtype: ocp4

title: "Check if any insecure registry sources is configured"

description: |-
    The configuration <tt>registrySources.insecureRegistries</tt> determines the
    insecure registries that the OpenShift container runtime can access for builds
    and pods. This configuration setting is for accessing the configured registries
    without TLS validation which could lead to security breaches and should be
    avoided.

rationale: |-
    Insecure registries should not be configured, which would restrict the possibilities of
    OpenShift container runtime accessing registries which cannot be validated.

severity: medium

identifiers:
  cce@ocp4: CCE-86023-9

references:
    nist: CM-7(2),CM-7(4),CM-7(5),CM-11
    srg: SRG-APP-000014-CTR-000035

ocil_clause: 'insecure registry sources is configured for image access'

ocil: |-
    <b>Audit:</b>

    To check for the configured insecure registry sources use below command:
    <tt>$ oc get image.config.openshift.io/cluster -ojsonpath='{.spec.registrySources}'</tt>
    The output lists the insecure registry sources configured.

    <b>Remediation:</b>
    To remove configured insecure resgitry sources use below command:
    <tt>$ oc edit image.config.openshift.io/cluster</tt>
    Remove any registries listed under insecureRegistries.

    Refer to https://docs.openshift.com/container-platform/latest/openshift_images/image-configuration.html
    for more details on configuring registries in OpenShift

warnings:
    - general: |-
        {{{ openshift_cluster_setting("/apis/config.openshift.io/v1/images/cluster") | indent(8) }}}

#template:
#    name: yamlfile_value
#    vars:
#        ocp_data: 'true'
#        filepath: /apis/config.openshift.io/v1/images/cluster
#        yamlpath: ".spec.registrySources.insecureRegistries[:]"
#        entity_check: "at least one"
#        values:
#            - value: ".*"
#              operation: "pattern match"
