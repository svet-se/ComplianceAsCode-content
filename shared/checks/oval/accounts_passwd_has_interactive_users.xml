<def-group>
  <definition class="compliance" id="accounts_passwd_has_interactive_users" version="1"> 
    <metadata>
      <title>Check for Interactive Users</title>
      <affected family="unix">
        <platform>multi_platform_all</platform>
      </affected>
      <description>Checks /etc/shadow for accouhts that have a password set.</description>
    </metadata>
    <criteria operator="AND">
      <criterion comment="Users who have a password set exist." test_ref="test_has_password_users"/>
    </criteria>
  </definition>

  <!-- Define a test for interactive users. Interactive users are defined as "users with a password" -->
  <unix:shadow_test
      id="test_has_password_users"
      check="all"
      check_existence="at_least_one_exists"
      version="1"
      comment="At least one user has a password">
    <unix:object object_ref="object_shadow_password_users"/>
  </unix:shadow_test>

  <unix:shadow_object id="object_shadow_password_users" version="1">
    <unix:username operation="pattern match">.*</unix:username>
    <filter action="exclude">state_accounts_shadow_has_no_password</filter>
  </unix:shadow_object>

  <unix:shadow_state id="state_accounts_shadow_has_no_password" version="1">
      <unix:password operation="pattern match">^(!|!!|\*)$</unix:password>
  </unix:shadow_state>

  <!-- Define a variable to return over interactive users. -->
  <local_variable id="var_has_interactive_users"
    version="1"
    datatype="string"
    comment="non-system users.">
    <object_component
      item_field="username"
      object_ref="object_shadow_password_users" />
  </local_variable>
</def-group>
