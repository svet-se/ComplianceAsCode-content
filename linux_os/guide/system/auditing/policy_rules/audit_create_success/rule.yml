documentation_complete: true

prodtype: rhel8

title: 'Configure auditing of successful file creations'

description: |-
    Ensure that successful attempts to create a file are audited.

    The following rules configure audit as described above:
    <pre>
    ## Successful file creation (open with O_CREAT)
    -a always,exit -F arch=b32 -S openat,open_by_handle_at -F a2&amp;0100 -F success=1 -F auid\>=1000 -F auid!=unset -F key=successful-create
    -a always,exit -F arch=b64 -S openat,open_by_handle_at -F a2&amp;0100 -F success=1 -F auid\>=1000 -F auid!=unset -F key=successful-create
    -a always,exit -F arch=b32 -S open -F a1&amp;0100 -F success=1 -F auid\>=1000 -F auid!=unset -F key=successful-create
    -a always,exit -F arch=b64 -S open -F a1&amp;0100 -F success=1 -F auid\>=1000 -F auid!=unset -F key=successful-create
    -a always,exit -F arch=b32 -S creat -F success=1 -F auid\>=1000 -F auid!=unset -F key=successful-create
    -a always,exit -F arch=b64 -S creat -F success=1 -F auid\>=1000 -F auid!=unset -F key=successful-create
    
    </pre>

    The <tt>Audit</tt> package provides pre-configured  rules in <tt>/usr/share/audit/sample-rules</tt>. The above content can be found in <tt>/usr/share/audit/sample-rules/30-ospp-v42-1-create-success.rules</tt>.
    To deploy this configuration, it is recommended to copy it over to the <tt>/etc/audit/rules.d/</tt> directory:
    <pre>
    cp /usr/share/audit/sample-rules/30-ospp-v42-1-create-success.rules /etc/audit/rules.d/
    </pre>
    
    The file has the following SHA-256 checksum:
    <pre>c97448ae2dcdbedb4c50464bfcec2a56886314d1ba8ee002f6bf63ec093b1b6b</pre>
    
    Load new Audit rules into kernel by running:
    <pre>augenrules --load</pre>
    

rationale: |-
    Auditing of successful attempts to create a file helps in investigation of actions which happened on the system.

severity: medium

identifiers:
    cce@rhel8: 82464-9

references:
    ospp: FAU_GEN.1.1.c
    nist: AU-2(a)
    srg: SRG-OS-000458-GPOS-00203,SRG-OS-000474-GPOS-00219,SRG-OS-000475-GPOS-00220,SRG-OS-000463-GPOS-00207,SRG-OS-000465-GPOS-00209,SRG-OS-000461-GPOS-00205

ocil_clause: 'the content or the hash of file differs or file does not exist'

ocil: |-
    To verify that the <tt>Audit</tt> is correctly configured according to recommended rules, check the content of the file with the following command:
    <pre>cat /etc/audit/rules.d/30-ospp-v42-1-create-success.rules</pre>
    The output has to be exactly as follows:
    <pre>
    ## Successful file creation (open with O_CREAT)
    -a always,exit -F arch=b32 -S openat,open_by_handle_at -F a2&amp;0100 -F success=1 -F auid>=1000 -F auid!=unset -F key=successful-create
    -a always,exit -F arch=b64 -S openat,open_by_handle_at -F a2&amp;0100 -F success=1 -F auid>=1000 -F auid!=unset -F key=successful-create
    -a always,exit -F arch=b32 -S open -F a1&amp;0100 -F success=1 -F auid>=1000 -F auid!=unset -F key=successful-create
    -a always,exit -F arch=b64 -S open -F a1&amp;0100 -F success=1 -F auid>=1000 -F auid!=unset -F key=successful-create
    -a always,exit -F arch=b32 -S creat -F success=1 -F auid>=1000 -F auid!=unset -F key=successful-create
    -a always,exit -F arch=b64 -S creat -F success=1 -F auid>=1000 -F auid!=unset -F key=successful-create
    
    </pre>
    You can check the SHA-256 hash of the file with the following command:
    <pre>sha256sum /etc/audit/rules.d/30-ospp-v42-1-create-success.rules</pre>
    The output of the command has to be exactly the following hash:
    <pre>c97448ae2dcdbedb4c50464bfcec2a56886314d1ba8ee002f6bf63ec093b1b6b</pre>

template:
    name: audit_rules_rule_file
    vars:
        file_id: 30-ospp-v42-1-create-success
